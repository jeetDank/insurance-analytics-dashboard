<mat-drawer-container style="width: 100vw; height: 100vh" autosize>
  <mat-drawer
    class="sidebar-container border-end"
    #drawer
    [opened]="false"
    mode="side"
  >
    <app-sidebar (sidebarData)="catchSidebarDataChange($event)"></app-sidebar>
  </mat-drawer>

  <div class="content">
    <nav class="sticky-top navbar nav-cust-props border-bottom">
      <div class="d-flex align-items-center w-100">
        <!-- uncomment to display the toggle sidebar button -->

        <!-- <span (click)="drawer.toggle()">
          <app-icon name="Menu"></app-icon>  

        </span> -->

        <span class="">
          <h5>Financial Analysis Dashboard</h5>
        </span>

        <p-button
          (click)="previousDashboards = true"
          class="ms-auto text-dark me-3"
          variant="outlined"
          icon="pi pi-history"
          severity="secondary"
          label="Previous Dashboards"
        />
        <p-button
          (click)="formulas = true"
          class="text-dark"
          variant="outlined"
          icon="pi pi-calculator"
          severity="secondary"
          label="Saved Formulas"
        />
      </div>
    </nav>
    <div class="canvas">
      <div class="banner">
        <div class="banner-icon-container me-3">
          <span class="pi pi-chart-bar"></span>
        </div>

        <div class="banner-icon-container">
          <span class="pi pi-chart-line"></span>
        </div>

        <div class="ms-4">
          <div>
            <h4 class="text-light">Financial Analysis Dashboard</h4>
          </div>
          <div class="text-light">
            AI generated insights through comparative analysis of SEC filings
          </div>
        </div>
      </div>

      <div class="query-container shadow-sm border">
        <textarea
          placeholder="Enter your analysis prompt here..."
          class="query-text-area w-100"
          name=""
          id=""
        ></textarea>
        <p-button class="mb-3 me-3" severity="contrast" icon="pi pi-send" />
      </div>

      <div class="sample-prompt-container mt-3">
        <div class="mb-3 w-100">Sample Prompts:</div>
        @for (item of samplePrompts; track $index) {
        <p-button
          class="mt-2 mb-2 me-2"
          variant="outlined"
          [label]="item.prompt"
          severity="secondary"
        />
        }
      </div>

      <div class="mb-2 mt-2">
        <p-progressbar mode="indeterminate" [style]="{ height: '3px' }" />
      </div>

      <div>
        <app-accordian></app-accordian>
      </div>

      <div class="row" cdkDropList (cdkDropListDropped)="drop($event)">
        @for (item of cardData; track $index) {
        <div class="col-sm-12 col-lg-6">
          <div class="draggable-card" class="mb-2" cdkDrag>
            <app-common-card [cardData]="item"></app-common-card>
          </div>
        </div>
        }
      </div>

      <div class="row mb-3">
        <div class="col-sm-12 col-lg-6">
          <app-container-card>
            <div>
              <div class="chart-title">Apple Revenue by Segment</div>
              <app-echarts
                style="height: 300px"
                [options]="appleOption"
              ></app-echarts>
            </div>
          </app-container-card>
        </div>
        <div class="col-sm-12 col-lg-6">
          <app-container-card>
            <div>
              <div class="chart-title">Microsoft Revenue by Segment</div>
              <app-echarts
                style="height: 300px"
                [options]="microsoftOption"
              ></app-echarts>
            </div>
          </app-container-card>
        </div>
      </div>

      <div>
        <div class="mt-2">
          @for (refData of referencesData; track $index) {
          <p-accordion [value]="0">
            <p-accordion-panel
              class="mt-3 shadow-sm rounded rounded-2 overflow-hidden"
              [value]="0"
            >
              <p-accordion-header>
                <div class="w-100 d-flex gap-2 rounded rounded-2">
                  <div class="text-success">
                    <i class="pi pi-link" style="font-size: 1.5rem"></i>
                  </div>
                  <div class="">References & Sources</div>
                  <p-tag
                    class="ms-auto me-3 fw-normal"
                    icon="pi pi-check-circle"
                    severity="secondary"
                    [value]="refData.totalRefCount + ' References'"
                  />
                </div>
              </p-accordion-header>

              <p-accordion-content>
                <!-- Sections iteration -->
                <div class="sections-container">
                  @for (section of refData.sections; track section.sectionName)
                  {
                  <div class="section-item mb-4 p-3 border rounded">
                    <!-- Section header -->
                    <div class="d-flex align-items-center gap-2 mb-3">
                      <h6 class="mb-0">{{ section.sectionName }}</h6>
                    </div>

                    <!-- References list -->
                    <div class="">
                      <ul class="list-unstyled">
                        @for (reference of section.references; track
                        reference.link) {
                        <li class="mb-3 d-flex align-items-start gap-3">
                          @if (reference.logo) {
                          <i
                            [class]="reference.logo"
                            class="mt-1 text-primary"
                            style="font-size: 1.125rem"
                          ></i>
                          }
                          <div class="flex-grow-1">
                            <a
                              [href]="reference.link"
                              target="_blank"
                              class="text-decoration-none"
                            >
                              <span class="d-flex align-items-center gap-2">
                                {{ reference.label }}
                                <i
                                  class="pi pi-external-link"
                                  style="font-size: 0.75rem"
                                ></i>
                              </span>
                            </a>
                          </div>
                        </li>
                        }
                      </ul>
                    </div>
                  </div>
                  }
                </div>
              </p-accordion-content>
            </p-accordion-panel>
          </p-accordion>

          }
        </div>
      </div>
    </div>
  </div>

  <p-scrolltop
    [threshold]="5"
    icon="pi pi-arrow-up"
    [buttonProps]="{ severity: 'contrast', raised: true, rounded: true }"
  />
</mat-drawer-container>

<p-drawer
  [(visible)]="previousDashboards"
  [style]="{ width: '350px' }"
  position="right"
  header="Past Dashboads"
>
  <app-past-dashboards></app-past-dashboards>
</p-drawer>

<p-drawer [(visible)]="formulas" [style]="{ width: '350px' }" position="right">
  <app-saved-formulas></app-saved-formulas>
</p-drawer>
